# PR: Convert models to DI-friendly initModel pattern

## Summary
This branch converts many Sequelize model modules to a dependency-injection friendly pattern where each model exposes an `initModel(sequelize)` factory and attaches `module.exports.initModel = initModel`. Where necessary, a backwards-compatible require-time auto-init is attempted inside a try/catch that requires `../utils/database` only when available.

Why:
- Allows an app factory to inject a Sequelize instance for isolated tests and runtime instances.
- Removes reliance on require-time DB singletons, reducing test flakiness and startup races.
- Keeps backwards compatibility during incremental migration.

## What changed
- Numerous model files in `backend/src/models` and `backend/models` now export `initModel(sequelize)` and `module.exports.initModel`.
- Some top-level consolidated models were wrapped to return a models map from `initModel`.
- Fixed lint and parse issues encountered during edits (duplicate import, inline-return linter findings).

Files touched (high level):
- backend/src/models/* (many: appconfigModel, authModels, catalogModel, communicationlogsModel, customerModel, database_configurationModel, ebayInfoModel, ebayListingImportRawModel, financialtrackingModel, itemModel, listingModel, listingOwnershipHistoryModel, orderdetailsModel, ownershipModel, ownershipagreementsModel, pageModel, performancemetricsModel, returnhistoryModel, roleModel, rolePageAccessModel, salesModel, shippinglogModel, userModel)
- backend/models/ebayIntegrationModels.js
- backend/models/ebayListingImportRawModel.js
- backend/models/ownershipModel.js

See full diff on branch `feature/init-model-di`.

## Validation
- Ran the backend Jest suite: `npx jest --runInBand --detectOpenHandles` — all tests passed.
  - Test Suites: 109 passed, 109 total
  - Tests: 211 passed, 211 total
- Ran `backend\scripts\run_build.bat` (Windows) — build completed successfully, Docker containers created, DB schema recreated, seed data loaded, frontend and backend built, API tests executed. See `backend/scripts/build.log` and `logs/API-Test-Results.txt` for details.

## Security note
`.env` was accidentally added during local edits and contained secrets (eBay sandbox credentials). I removed `.env` from the commit history on this branch and it is not present in the pushed commits. Ensure secrets are stored in repository secrets or a secure vault and not committed.

## Checklist for reviewers
- [ ] Confirm model shape and associations look correct after `initModel(sequelize)` changes.
- [ ] Verify no production code still relies on require-time initialization where possible.
- [ ] Confirm CI passes (I ran local tests and build; please run CI pipelines).
- [ ] Review the PR description and test logs in `logs/API-Test-Results.txt`.

## How to test locally (Windows)
1. Start Docker Desktop.
2. From repo root run in PowerShell:

```powershell
cd f:\Dev\ListFlowHQ\backend
.\scripts\run_build.bat
```

3. To run only unit tests:

```powershell
cd f:\Dev\ListFlowHQ\backend
npx jest --runInBand --detectOpenHandles
```

## Next steps (follow-ups)
- Continue converting any remaining model files not yet using `initModel` in small batches and run tests between batches.
- Remove the require-time auto-init shims once all call sites use the app factory.
- Add a brief migration note to `docs/` describing the new model init pattern and the recommended app factory usage.

---

Generated by automation on branch `feature/init-model-di`.
